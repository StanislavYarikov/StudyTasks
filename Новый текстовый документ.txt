Использование алгоритмов машинного обучения в анализе и прогнозировании режимных параметров бурения
Яриков С.А.1, Дадакин Н. 1, Саренков А.В.1, Горохов А.П.1
1 – ОАО РН-КрасноярскНИПИнефть

Краткое содержание
Прогнозирование параметров технологического режима актуально в любом процессе бурения. Подготовленные модели машинного обучения позволяет получить прогнозное значение режимных параметров без применения сложных расчетов, используя ранее накопленный опыт. Чтобы применять новые инструменты нужно использовать и новые подходы к анализу имеющихся данных. Главным вопросом оказывается разметка возможных для прогнозирования случаев.
Собраны данные на основе режимных значений параметров бурения, обобщенных за интервалы по стволу. Построена модель машинного обучения для определения значения эквивалентной циркуляционной плотности (ЭЦП) опираясь только на проектные значения конструкции скважины и геологии. С помощью данного прогноза получается определить области, где происходило отклонение фактического значения ЭЦП от предполагаемого. Таким образом проведена переразметка данных и определены цели прогноза. С помощью машинного обучения можно классифицировать эти состояния. Обсуждаются варианты интерпретации.
Любые специальные условия задачи для машинного обучения накладывают ограничения на используемые данные. В статье также обсуждаются особенности данных бурения и ограничения выбора таких данных для обучения. Рассмотрена задача прогнозирования случаев определенного типа. Выделены участки, где ЭЦП приходилось увеличивать из-за повышенных газопоказаний путем увеличения плотности раствора. В качестве предикторов взяты режимные параметры за предшествующие интервалы бурения. Алгоритмы, обученные конкретно на таких случаях, способны их в дальнейшем прогнозировать. Прогноз говорит о возможной необходимости в следующем интервале бурения повысить плотность раствора и отличать такие состояния от тех, когда плотность раствора останется неизменной. Рассмотрены трудности в оценке таких прогнозов из-за разного подхода к контролю параметров раствора. 

Ключевые слова: БУРЕНИЕ, ОСЛОЖНЕНИЯ, ПРОГНОЗИРОВАНИЕ, ЭЦП, ТЕХНОЛОГИЧЕСКИЙ РЕЖИМ, МАШИННОЕ ОБУЧЕНИЕ

Врезка
Важным аспектом успешного развития ПАО «НК «Роснефть» является накапливание и обобщение опыта проводимых работ. Современные задачи решаются с помощью новейших аналитических инструментов, которые могут заменить классические. Важным здесь являются не только сами данные, но и принципы работы с ними. В статье используются приемы обработки и выбора данных бурения нефтяных скважин для обучения и корректной работы алгоритмов машинного обучения. Результаты работы показывают возможность прогнозирования конкретных обстоятельств при сопровождении бурения на основе имеющихся данных.

Введение
Параметры технологического режима бурения нефтяных скважин отражают происходящие процессы и служат основой для принятия решений экспертами. Постепенное накапливание и структурирование массива подобных данных делает возможным строить модели для прогнозов.
В процессе бурения скважин может возникнуть ряд осложнений. Правильный подбор механических режимных параметров и гидродинамических характеристик раствора помогает их избежать. В ходе мониторинга выявляются некоторые факторы риска. И значимой помощью экспертам в этом процессе могли бы служить любые дополнительные сведения о предстоящих интервалах бурения. В работе проверяется предположение, что даже округленные данные предыдущих интервалом могут дать полезную информацию о том, на что обратить более пристальное внимание.
Алгоритмы машинного обучения способны выявить общие закономерности в данных и использоваться таким образом для построения цифровых рекомендательных систем.

Описание набора данных
Исследуемы набор данных содержал информацию с __ скважин, включая бурение боковых стволов. В ходе буровых работ параметры технологического режима собираются и округляются за интервалы бурения. Всего набор содержал 1459 записей, каждая из которых соответствовала отдельному интервалу бурения. Эти интервалы имеют разную длину, как по стволу, так и по вертикали. Средняя длина участков около 30 метров (медианное значение около 20 метров).
В числе параметров содержатся как проектные геологические и конструкционные параметры, так и параметры технологического режима, собранные из ежедневных сводок. Среди них есть параметры, которые прямо зависят от глубины, и такие, которые резко меняются при переходе с одной секции на другую. Также необходимо было учесть особенности величин, которые обладали дискретным спектром значений. Разные подходы при работе с ними описаны ниже.
Учет признаков, которые имеют прямую привязку к конкретной глубине по стволу делает прогноз более частным. Поэтому, например, вместо пластового давления и давления гидроразрыва пласта взяты их градиенты. Помимо этого, от градиентов зависит выбор плотности раствора (а следовательно, и величина ЭЦП) не на отдельном интервале, а, в основном, на целой секции, включающей повышенный градиент давления. Поэтому в качестве признаков для прогнозных моделей использовались максимальные и минимальные значения градиента пластового давления и градиента ГРП в рамках секций.
Наличие дискретности (небольшого количества уникальных значений) у некоторых признаков, приводит к необходимости объединять их в группы. Это связано с тем, что уникальных значений недостаточно для того, чтобы строить непрерывную зависимость от этих параметров. Таким образом данные сегментируются. Но и внутри выборки в рамках некоторых уникальных значений оказывается мало записей, а следовательно, и недостаточно статистических данных для работы. Поэтому объединение признаков в группы дает возможность задействовать больше данных и обобщить прогноз. Таким образом, выделено 5 диапазонов по диаметру секции и 4 диапазона по плотности пород. Данные по пористости пород разделены только на 2 диапазона.

Постановка задачи
Наиболее полезным результатом, ожидаемым от цифровой рекомендательной системы, видятся сведения о том, что в последующем интервале бурения может возникнуть необходимость корректировки технологических параметров. Это позволяет, если это возможно, принять нужные решения заранее.
Среди расчетных параметров бурения одним из самых сложных и показательных является эквивалентная циркуляционная плотность (ЭЦП). Величина ЭЦП зависит от множества исходных параметров, а также величин, рассчитанных на их основе. На некоторых участках бурения происходило вынужденное повышение или понижение ЭЦП. Задачей стало разметить эти интервалы и проверить возможность их прогнозирования. В моделях прогноза ЭЦП должны быть задействованы только исходные технологические, проектные и геологические параметры как уникальные и независимые источники информации.

Подготовка данных
Важно понимать, что не все записи могут быть использованы как для обучения алгоритмов машинного обучения, так и для оценки. Это связано не с их качеством, а с особенностями технологического процесса. Есть два самых очевидных обстоятельства из-за которых исключена часть записей.
1.	Из рассмотрения исключены данные непосредственно перед переходом с одной секции на другую. Так как, во-первых, происходит скачкообразное изменение параметров (например, плотности раствора).  Он является запланированным и прогнозировать его не нужно. А во-вторых, не известно потребовалось бы изменение технологических параметров, если бы бурение продолжалось в этой же секции с теми же конструкционными и гидродинамическими характеристиками.
2.	Не использовались данные из интервалов, где фиксировались потери циркуляции и непосредственно после восстановления циркуляции. В моменты поглощения записанная в данных плотность раствора может уменьшится. Последующее восстановление плотности раствора до уровня перед началом поглощения не должно рассматриваться как необходимое увеличение и путаться таким образом с другими причинами. Другими словами, использовались только успешные интервалы бурения.
Помимо этого, в процессе подготовки данных для конкретной задачи становится ясно в каких пропорциях распределены классы. Способ балансировки и дополнительные условия задачи могут также сократить количество используемых данных.
Все циклы обучения моделей машинного и прогноза осуществлялись по процедуре кросс-валидации. Происходило исключение всех данных с одной из скважин, обучение модели и последующий прогноз на исключенных данных. Все скважины поочередно выступали в роли тестовой. И все тестовые данные суммировались для общей оценки. Таким образом выявляется обобщающая способность алгоритмов в рамках поставленной задачи.
Основным алгоритмом в работе был выбран градиентным бустингом над решающими деревьями. С представленным набором данных он работает точнее, чем отдельные решающие деревья или Random Forest. Полносвязные и рекуррентные нейронные сети не показывали существенного улучшения результатов. Их применение будет обосновано при наборе из большего количества данных или из более детализированных записей.

Регрессионная задача на проектных параметрах
Первым этапом работы стало решение регрессионной задачи без использования параметров технологического режима. Были взяты только проектные параметры, которые известны до начала бурения. Среди них такие конструкционные параметры как диапазон диаметра секции, длина необсаженного ствола, площадь кольцевого сечения, угол наклона интервала бурения и инклинометрия по всему стволу. Также в модель включены геологические величины: максимальные и минимальные значения градиента ГРП и градиента пластового давления в рамках секции, диапазон пористости и плотности пород.
Решение на всех отобранных данных дает среднюю ошибку прогнозирования ЭЦП около 0,115. НА некоторых интервалах бурения ошибка довольно большая и выражается как в завышенных, так и заниженных прогнозных значениях ЭЦП. Такие ошибки не сосредоточены исключительно на определенных скважинах или на породах с определенными характеристиками. Единственный признак, по которому можно разделить разные порядки точности – диапазон диаметра секции. На рисунке 1 (а) продемонстрировано, что в независимости от скважины средняя абсолютная ошибка ЭЦП бурения на начальных секциях (с наибольшим диаметром) имеет значение меньше 0,05. Основные несоответствия наблюдаются в областях более узких диаметров секций (диапазоны D3, D4 и D5). Средняя абсолютная ошибка суммарно в этих секциях имеет значение 0,135. Это объясняется тем, что более глубокие пласты и обладают наибольшим разнообразием свойств. Если сделать предположение, что в данных интервалах условия работы сильно отличаются от вышележащих, то можно разделить датасеты по этому признаку. Отдельное обучение на более глубинных данных, то ошибка прогноза в узких секциях становится меньше и равна около 0,129. В тоже время отдельное обучение и прогноз на широких секциях дает среднюю абсолютную ошибку 0.022. Во-первых, здесь меньшее разнообразие всех параметров. А во-вторых, само значение ЭЦП в широких секциях имеет заметно меньшую величину.






Рисунок 1 – Средняя абсолютная ошибка прогнозирования ЭЦП в разных скважинах по секциям. По вертикали: условный номер скважины; по горизонтали: условный диапазон диаметров секции (в сторону уменьшения слева направо). (а) – обучение на всех релевантных данных, (б) – обучение на данных с наиболее узких секций.

Обучение на данных только с секций наименьшего диаметра хоть немного улучшает прогноз, но при этом оценка на секциях с наибольшим диаметром становится хуже (Рисунок 1, б). Самые значимые ошибки совершаются в тех же характерных местах.
Данный алгоритм дает прогноз, укладывающийся в окно градиентов. И случаи больших ошибок такого алгоритма представляют наибольшие интерес. Таким образом, данные прогнозы можно использовать для обнаружения нетипичных решений по работе с завышенной или заниженной величиной ЭЦП.

Задача классификации нетипичных значений ЭЦП
По результатам работы описанного выше алгоритма отбирались около 100 записей с наибольшим отличием прогнозируемого ЭЦП от фактического, как в большую сторону (прогноз > факт. ЭЦП), так и в меньшую (прогноз < факт. ЭЦП). Для балансировки классов также отобрано 100 записей, прогноз в которых наилучшим образом совпадал с фактическими значениями.
Построен классификатор, использующий те же признаки, что и регрессионная модель. В каждом случае в качестве класса «1» брались данные одного из типов отличий прогноза от фактических значений, а в качестве класса «0» – данные, совпадающие с прогнозом. Оценка проводилась, как и раньше, на прогнозах при кросс-валидации по данным с отдельных скважин целиком. Метрики работы классификаторов представлены в Таблице 1.  

Таблица 1. Метрики алгоритмов классификации
	Точность 	Полнота
прогноз < факт. ЭЦП	0,79 – 0,83	0,75 – 0,79
прогноз > факт. ЭЦП	0,71 – 0,76	0,64 – 0,69
прогноз < или > факт. ЭЦП	0,83 – 0,86	0,80 – 0,82

Определение интервалов, где прогнозные значения ЭЦП сильно ниже фактических оказывается лучше, чем определение отличий другого знака. Метрика «полнота» показывает, что первый классификатор эффективно выявляет интервалы, где ожидается повышенное значение ЭЦП. Во втором классификаторе полнота меньше. Это означает, что в данном случае интервалы с пониженным ЭЦП выявляются хуже, и более правильно определяются интервалы, где прогноз совпадает с фактическим значением.
Последняя строчка в таблице 1 показывает результаты работы классификатора, где в качестве класса «1» взяты отличия прогноза от фактических значений обоих знаков, а в качестве класса «0» – 200 записей, наиболее совпадающих с прогнозом. Метрики такого классификатора оказываются лучше, чем у предыдущих. Это можно объяснить тем, что различия в смысле «недостатка» или «избытка» ЭЦП на самом деле могут оказаться не столь велики. Алгоритм обучается на фактических данных, где принимались разнородные решения. Например, если в одном случае после прохождения участка с повышенным градиентом ГРП, ЭЦП может сохраняться до окончания секции, то в другом случае ЭЦП снижалось сразу после этого участка. Тогда алгоритм может принять за более общий первый случай и во втором во время решения регрессионной задачи показать прогнозное значение больше, чем фактическое. Хотя по факту это значение ЭЦП могло быть больше и считаться завышенным. Также низкое значение ЭЦП может наблюдаться перед резким ростом. В этом случае тоже можно считать, что увеличение могли совершить и раньше, тогда данная запись должна быть отнесена в другой класс.
Таким образом наиболее точный алгоритм показывает области, где есть наибольшая вероятность столкнуться с отклонением ЭЦП от расчетного значения. Точнее, в этих случаях наиболее вероятное решение экспертов носило бы такой характер.

Учет параметров технологического режима
Предыдущие прогнозы были основаны только на тех параметрах, которые известны еще до начала бурения. Поэтому они свободно использовались для прогноза на любом интервале. Если подключать, параметры технологического режима, то для прогноза должны быть использованы только те значения, которые уже известны до начала работы с данным интервалом. Другими словами, для прогнозирования какой-либо величины в данном интервале мы должны учитывать технологические параметры только с предыдущих интервалов. При этом проектные параметры можно использовать как с предыдущих интервалов, так и с прогнозируемого. Отсюда, количество данных сокращается, потому что необходимо выполнить следующие условия:
1.	Все используемые для одного прогноза интервалы должны лежать в рамках одной секции.
2.	На всех предыдущих используемых интервалах и на прогнозируемом не должно быть потери циркуляции.
Если использовать признаки двух предыдущих интервалов, то остается 812 записей для прогноза в наиболее узких секциях. Точность предыдущего классификатора на отобранных данных оказывается хуже (около 0,68-0,70). Возможно, ограничения исключают наиболее явные из них, например, в начале секций. Однако включение в модель параметров технологического режима (механическая скорость, обороты ротора, нагрузка на долото, расход буровых насосов) за 2 предыдущих интервала бурения улучшает точность до 0,71 – 0,73.

Прогнозирование необходимости увеличения плотности раствора
Обучение в предыдущих случаях происходило на общих данных без детального разбора всех обстоятельств. Была предпринята попытка проверить прогнозную способность алгоритмов машинного обучения на задаче с более конкретными условиями. Проверялось, можно ли детектировать специально отобранные случаи среди остальных записей.
 Среди причин увеличения ЭЦП одной из наиболее явных является увеличение плотности раствора. Эти факты часто отмечены при повышенных значениях газопоказаний. Была проведена ручная разметка таких случаев. Отмечались только интервалы, на которых непосредственно произошло увеличение плотности раствора. Последующие интервалы исключались из рассмотрения. В качестве рабочих данных были выбраны интервалы, которые находились вдали от начала секций. При этом из рабочих данных исключались записи за несколько интервалов до факта увеличения плотности раствора.
Стоит отметить, что сам параметр «газопоказания» не входил в число предикторов. Модель обучалась на используемые ранее проектных параметрах и параметрах технологического режима с предыдущих интервалов. Точность полученной модели на сбалансированной выборке оказалась около 0.65 при полноте 0.67. Таким образом, данный классификатор в 65% случаев может верно предсказать возможную необходимость увеличения плотности раствора на следующем интервале бурения. Также результат можно интерпретировать так, что в схожих обстоятельствах вероятным было принятие решения об увеличении плотности раствора.


Заключение
Модели машинного обучения, обученные на исторических данных, могут участвовать в прогнозировании параметров бурения. В частности, прогнозировались интервалы, где можно ожидать изменение величины ЭЦП.
Параметры режима бурения несут информацию о возможных осложнениях. Их учет за предыдущие интервалы бурения дает увеличение точности прогноза.
Можно обучать алгоритмы на решение некоторые частных задач. Подробное описание условий делает результат более понятным. Поэтому возможно включение других параметров и доработка моделей для конкретных целей производства.
Работа и оценка таких алгоритмов осложняется наличием различных неучтенных обстоятельств. Например, в дальнейшем предстоит выяснить как учитывать и прогнозировать интервалы с потерей циркуляции.

